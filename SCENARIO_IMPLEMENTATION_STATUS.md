# 场景实现状态检查

## 📋 REQ-REG-FORM 场景（注册表单场景）

### 1. 用户名验证场景（8个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 失去焦点触发验证 | ✅ 已实现 | `handleBlur('username')` | 无 |
| 2 | 长度小于6位 | ⚠️ 部分实现 | `length < 6` | 需改为精确错误消息："用户名长度不能少于6个字符！" |
| 3 | 长度大于30位 | ⚠️ 部分实现 | `length > 30` | 需改为精确错误消息："用户名长度不能超过30个字符！" |
| 4 | 开头不是字母 | ⚠️ 部分实现 | 正则检查 | 需改为精确错误消息："用户名只能由字母、数字和_组成，须以字母开头！" |
| 5 | 包含特殊字符 | ⚠️ 部分实现 | 正则检查 | 需改为精确错误消息："用户名只能由字母、数字和_组成，须以字母开头！" |
| 6 | 已注册的用户名 | ❌ 未实现 | 无 | 需添加后端API检查：`/api/auth/check-username` |
| 7 | 未注册的合法用户名 | ❌ 未实现 | 无 | 需在唯一性检查通过后显示绿色勾勾 |
| 8 | 显示绿色勾勾 | ✅ 已实现 | 验证通过显示✓ | 无 |

**修复优先级**: 🔴 高
- 需要添加 API-CHECK-USERNAME 后端接口
- 需要调整错误消息与YAML完全一致

---

### 2. 密码验证场景（5个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 失去焦点触发验证 | ✅ 已实现 | `handleBlur('password')` | 无 |
| 2 | 长度小于6位 | ⚠️ 部分实现 | `length < 6` | 需改为："密码长度不能少于6个字符！" |
| 3 | 包含特殊字符 | ❌ 未实现 | 无 | 需添加："格式错误，必须且只能包含字母、数字和下划线中的两种或两种以上！" |
| 4 | 只包含单一字符类型 | ❌ 未实现 | 无 | 需添加验证逻辑和错误提示 |
| 5 | 符合规范 | ⚠️ 部分实现 | 基本验证 | 需添加"至少包含两种字符类型"验证 |

**缺失功能**:
- ❌ 密码强度指示器（显示弱/中/强，用条形图表示）
- ❌ 密码复杂度验证（字母+数字+下划线，至少两种）

**修复优先级**: 🔴 高

---

### 3. 确认密码验证场景（3个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 失去焦点触发验证 | ✅ 已实现 | `handleBlur('confirmPassword')` | 无 |
| 2 | 与密码不一致 | ✅ 已实现 | `value !== password` | 无 |
| 3 | 与密码一致 | ✅ 已实现 | 显示绿色勾勾 | 无 |

**修复优先级**: ✅ 完成

---

### 4. 证件类型选择场景（2个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 默认选择 | ✅ 已实现 | `idType: '1'` 默认居民身份证 | 无 |
| 2 | 手动选择 | ✅ 已实现 | `<select>` 下拉框 | 无 |

**修复优先级**: ✅ 完成

---

### 5. 姓名验证场景（5个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 失去焦点触发验证 | ⚠️ 简化实现 | 基本验证 | 需完善 |
| 2 | 长度过短（<3字符） | ❌ 未实现 | 无 | 需添加："允许输入的字符串在3-30个字符之间！" |
| 3 | 长度过长（>30字符） | ❌ 未实现 | 无 | 需添加："允许输入的字符串在3-30个字符之间！" |
| 4 | 包含特殊字符 | ❌ 未实现 | 无 | 需添加："请输入姓名！" |
| 5 | 符合规范 | ⚠️ 简化实现 | 仅显示勾勾 | 需添加完整验证 |

**注意**: 1个汉字算2个字符

**修复优先级**: 🔴 高

---

### 6. 证件号码验证场景（6个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 失去焦点触发验证 | ⚠️ 简化实现 | 基本验证 | 需完善 |
| 2 | 长度过短 | ❌ 未实现 | 无 | 需添加："请正确输入18位证件号码！" |
| 3 | 长度过长（自动截取） | ❌ 未实现 | 无 | 需添加maxLength=18 |
| 4 | 包含特殊字符 | ❌ 未实现 | 无 | 需添加："输入的证件编号中包含中文信息或特殊字符！" |
| 5 | 身份证校验失败 | ❌ 未实现 | 无 | 需添加身份证校验码算法 |
| 6 | 符合规范 | ⚠️ 简化实现 | 仅显示勾勾 | 需添加完整验证 + 唯一性检查 |

**修复优先级**: 🟡 中

---

### 7. 优惠类型选择场景（2个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 默认选择 | ✅ 已实现 | `passengerType: '1'` 默认成人 | 无 |
| 2 | 手动选择 | ✅ 已实现 | `<select>` 下拉框 | 无 |

**修复优先级**: ✅ 完成

---

### 8. 邮箱验证场景（4个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 失去焦点触发验证 | ⚠️ 未完全实现 | 无验证逻辑 | 需添加 |
| 2 | 格式不正确 | ❌ 未实现 | 无 | 需添加："请输入有效的电子邮件地址！" |
| 3 | 格式正确 | ❌ 未实现 | 无 | 不显示错误提示 |
| 4 | 未填写（选填） | ✅ 已实现 | 不强制验证 | 无 |

**修复优先级**: 🟡 中

---

### 9. 手机号验证场景（8个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 失去焦点触发验证 | ✅ 已实现 | `handleBlur('phone')` | 无 |
| 2 | 长度过短 | ✅ 已实现 | 正则检查 | 无 |
| 3 | 长度过长自动截取 | ❌ 未实现 | 无 | 需添加maxLength=11 |
| 4 | 包含非数字字符 | ✅ 已实现 | 正则检查 | 无 |
| 5 | 不以1开头 | ✅ 已实现 | `/^1/` | 无 |
| 6 | 第二位不符合规范 | ✅ 已实现 | `/^1[3-9]/` | 无 |
| 7 | 已被注册 | ❌ 未实现 | 无 | 需添加后端API检查：`/api/auth/check-phone` |
| 8 | 符合规范 | ✅ 已实现 | 显示绿色勾勾 | 需添加唯一性检查 |

**修复优先级**: 🔴 高（唯一性检查）

---

### 10. 用户协议场景（2个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 未勾选用户协议 | ✅ 已实现 | 提交时检查 | 无 |
| 2 | 已勾选用户协议 | ✅ 已实现 | `agreement: true` | 无 |

**修复优先级**: ✅ 完成

---

### 11. 提交按钮场景（3个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 必填字段未填写完整 | ⚠️ 部分实现 | 基本检查 | 需完善所有字段检查 |
| 2 | 任一字段验证失败 | ✅ 已实现 | `Object.keys(errors).length > 0` | 无 |
| 3 | 所有字段验证通过且协议已勾选 | ✅ 已实现 | 发送验证码API | 无 |

**修复优先级**: 🟡 中

---

## 📋 REQ-REG-VERIFICATION 场景（验证弹窗场景）

### 验证弹窗场景（9个）

| # | 场景名称 | 状态 | 当前实现 | 需要修改 |
|---|---------|------|---------|---------|
| 1 | 验证码为空 | ✅ 已实现 | `length !== 6` | 改为alert → 输入框下方提示 |
| 2 | 验证码长度不为6位 | ✅ 已实现 | `length !== 6` | 同上 |
| 3 | 验证码正确且未过期 | ⚠️ 部分实现 | API调用 + alert | 需改为成功弹窗（绿色圆圈✓ + 成功消息 + 2秒自动跳转） |
| 4 | 验证码错误 | ⚠️ 部分实现 | alert错误 | 需改为输入框下方提示 |
| 5 | 验证码已过期 | ⚠️ 部分实现 | alert错误 | 需改为输入框下方提示 |
| 6 | 点击返回修改按钮 | ✅ 已实现 | `onBack()` 关闭弹窗 | 无 |
| 7 | 点击关闭按钮（未成功） | ❌ 未实现 | 直接关闭 | 需添加确认对话框："确定要关闭验证弹窗吗？..." |
| 8 | 点击关闭按钮（已成功） | ❌ 未实现 | 无 | 需区分成功/未成功状态 |
| 9 | 成功状态显示 | ❌ 未实现 | 无 | 需实现成功状态UI（绿色圆圈✓ + "恭喜您注册成功！正在跳转登录页..." + 2秒自动跳转） |

**修复优先级**: 🔴 高

---

## 🎯 优先级总结

### 🔴 高优先级（影响核心功能）

1. **用户名唯一性检查**
   - 后端API: `POST /api/auth/check-username`
   - 返回: `{ available: boolean, message: string }`

2. **手机号唯一性检查**
   - 后端API: `POST /api/auth/check-phone`
   - 返回: `{ available: boolean, message: string }`

3. **密码强度指示器**
   - 添加密码复杂度验证（至少两种字符类型）
   - 显示密码强度条（弱/中/强）

4. **验证弹窗改进**
   - 错误提示改为输入框下方（不使用alert）
   - 成功状态UI（绿色圆圈✓ + 消息 + 自动跳转）
   - 关闭按钮确认对话框

5. **姓名验证完善**
   - 长度验证（3-30字符，汉字算2字符）
   - 特殊字符验证

### 🟡 中优先级（影响用户体验）

1. **证件号码验证完善**
   - 长度验证（18位）
   - 身份证校验码算法
   - 唯一性检查

2. **邮箱验证**
   - 格式验证
   - 错误提示

3. **字段长度限制**
   - 手机号maxLength=11
   - 证件号码maxLength=18

### 🟢 低优先级（优化项）

1. **错误消息精确匹配**
   - 将所有错误消息调整为与YAML完全一致

2. **输入框自动截取**
   - 超长输入自动截取

---

## 📝 实施计划

### 阶段1: 后端API扩展
1. 创建 `/api/auth/check-username` 接口
2. 创建 `/api/auth/check-phone` 接口
3. 添加证件号码唯一性检查（可选）

### 阶段2: 前端验证完善
1. 完善用户名验证（添加唯一性检查）
2. 完善密码验证（添加复杂度检查 + 强度指示器）
3. 完善姓名验证（长度 + 特殊字符）
4. 完善手机号验证（添加唯一性检查 + maxLength）
5. 添加邮箱验证
6. 完善证件号码验证

### 阶段3: 验证弹窗改进
1. 将alert改为输入框下方提示
2. 实现成功状态UI
3. 添加关闭按钮确认对话框
4. 实现2秒自动跳转

### 阶段4: 错误消息对齐
1. 将所有错误消息调整为YAML中的精确文字

---

## ✅ 立即开始实施

现在开始按照以上计划实施修复。
