# UI Analyzer Prompt 精简计划

**当前问题**：
- 当前 prompt 长度：约 2581 行
- 包含大量重复的、针对 login-page 的示例代码
- 完整的下载脚本（~150行）和CSS示例（~300行）占用大量篇幅

---

## 精简策略

### 1. 删除冗余代码（预计减少 ~600行）

#### 1.1 Phase 4: 删除完整下载脚本
**位置**：约 line 600-755  
**替换为**：
```markdown
**步骤3: 创建并执行下载脚本**

关键要点：
1. 从 Phase 4 步骤1-2 获得资源列表
2. 使用 Node.js http/https 模块下载
3. 保存每个资源的 metadata（原始尺寸、显示尺寸、CSS策略）
4. 文件命名：`{页面名}-{组件名}-{用途}.{ext}`
```
**减少**：~155行 → ~10行

---

#### 1.2 Phase 6: 删除详细CSS示例
**位置**：约 line 1172-1469  
**替换为**：
```markdown
**步骤2: 生成 ui-style-guide.md**

**文档结构**：
1. 颜色体系（品牌色、主题色、文本色、状态色）
2. 每个组件的完整 CSS（可直接复制）
   - 组件位置说明
   - 核心样式代码
   - 交互状态样式（hover/focus/disabled/error）
   - 引用交互截图作为样式来源

**关键点**：
- 所有 CSS 使用 `!important`
- 注释标明颜色/尺寸来源（截图 or 测量）
- 包含图片资源的注释（原始尺寸 + CSS策略）
```
**减少**：~297行 → ~15行

---

### 2. 合并重复示例（预计减少 ~300行）

#### 2.1 Phase 2-3: 工具调用示例
**当前问题**：每个 Phase 都有详细的JavaScript代码示例  
**优化方案**：只保留关键参数，删除完整代码

**示例：Before**
```javascript
mcp_cursor-browser-extension_browser_evaluate({
  function: `() => {
    const result = { backgrounds: [], images: [] };
    // ... 50行代码
  }`
})
```

**示例：After**
```markdown
**步骤1: 提取所有图片资源**
- 使用 `browser_evaluate` 分析页面
- 获取所有 `<img>` 标签（src, alt, naturalWidth, displayWidth）
- 获取所有背景图片（从 computed style）
```
**减少**：~150行 → ~10行

---

#### 2.2 Phase 5: 布局分析代码
**当前问题**：完整的递归分析函数  
**优化方案**：说明关键步骤即可

**减少**：~80行 → ~15行

---

#### 2.3 Phase 7: executeStep 函数
**当前问题**：详细的 switch-case 实现  
**优化方案**：使用表格总结 action 类型

**当前**：约100行的完整函数  
**替换为**：
| action | 功能 | 关键参数 | MCP工具 |
|--------|------|---------|---------|
| type | 输入文本 | target_hint, value | browser_type |
| click | 点击元素 | target_hint | browser_click |
| wait | 等待 | duration | browser_wait_for |
| screenshot | 截图 | filename | browser_take_screenshot |

**减少**：~100行 → ~15行

---

### 3. 简化示例数量（预计减少 ~200行）

#### 3.1 保留1个通用模板 + 1个简化示例

**当前**：每个部分有3个完整示例（电商/用户中心/仪表板）  
**优化后**：
- 1个通用模板（占位符）
- 1个简化示例（关键要点）

**示例：Phase 6 的 ui-requirements.yaml 输出**

**当前**：约150行（3个完整示例）  
**优化为**：
```yaml
# 通用模板（占位符）
- id: REQ-{PAGE-ID}
  name: {页面名称}
  description: |
    {功能描述}
    
    **整体布局分析**: {ASCII图}
    **颜色体系**: {品牌色、主题色、文本色}
    **CSS 布局方式**: {Flexbox/Grid/Position}
    **网页资源**: {路径、尺寸、CSS策略}
    **参考图片**: "./images/{路径}"

# 简化示例（仅展示关键结构）
- id: REQ-PRODUCT-LIST
  name: 商品列表页
  description: |
    **布局**: 顶部搜索栏 + 左侧筛选器 + 右侧商品Grid
    **颜色**: 品牌橙#FF6B00, 价格红#E53935
    **资源**: 商品图片(800×800 → 280×280, object-fit:cover)
```
**减少**：~150行 → ~30行

---

## 总结预估

| 部分 | 当前行数 | 优化后 | 减少 |
|-----|---------|--------|------|
| Phase 4 下载脚本 | ~155 | ~10 | -145 |
| Phase 6 CSS示例 | ~297 | ~15 | -282 |
| Phase 2-5 代码示例 | ~230 | ~40 | -190 |
| Phase 7 实现函数 | ~100 | ~15 | -85 |
| 重复示例合并 | ~200 | ~50 | -150 |
| **总计** | **~982** | **~130** | **~852** |

**优化后总长度**：约 **1730行**（减少 33%）

---

## 核心保留内容

✅ **必须保留**：
1. 角色定义和核心任务（明确最终目标）
2. 7个 Phase 的结构和关键步骤
3. 通用模板（占位符）
4. 1个简化示例（展示结构）
5. 关键原则和错误处理策略
6. 交互场景的安全凭证管理
7. 通用组件定位策略表格
8. 资源匹配规则表格

❌ **可以删除**：
1. 完整的 JavaScript 实现代码
2. 冗长的 CSS 示例代码
3. 重复的3个页面类型示例
4. 详细的辅助函数实现
5. login-page 特定的命名和代码

---

## 实施步骤

1. **Phase 1**: 保持不变（初始化步骤简洁）
2. **Phase 2**: 删除完整截图工具调用代码，保留关键步骤
3. **Phase 3**: 删除详细DOM查找代码，保留定位策略表格
4. **Phase 4**: 删除完整下载脚本，保留关键要点
5. **Phase 5**: 删除递归分析函数，保留测量要点
6. **Phase 6**: 删除完整CSS示例，保留文档结构说明
7. **Phase 7**: 删除 executeStep 函数，改用 action 类型表格

**预计完成时间**：需要重写约 10个大块内容

