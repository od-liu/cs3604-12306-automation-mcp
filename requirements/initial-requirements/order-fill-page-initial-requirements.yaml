# 订单填写页初始需求文档
# 这是提供给 UI Analyzer Agent 的输入文档
# Agent 会自动获取截图、图片资源和交互场景截图

# ⚠️ 使用说明：
# 1. 如果某个组件需要交互场景截图，请在 description 中添加 "**交互场景截图**:" 字段
# 2. 如果交互场景需要登录凭证，请在 "**登录凭证**:" 中填写或引用环境变量
# 3. Agent 会按照 steps 中定义的步骤自动执行交互并截图
# 4. 支持的 action 类型: type, click, wait, wait_for_element, screenshot, evaluate 等

- id: REQ-ORDER-FILL-PAGE
  name: 订单填写页
  description: |
    用户预订车票后填写订单信息的页面。
    
    **网站地址**: http://localhost:5173/order
    **页面宽度参考**: 1920px
    **页面标识**: order-fill
    
    **访问方式**:
    1. 需要先登录（打开http://localhost:5173/为已经自动登录状态，从该页面开始操作）
    2. 在首页选择出发地北京，到达地上海，时间为明天（1月18日）
    3. 点击查询后，在车次列表页选择G103次（北京南站06:20开 - 上海虹桥站11:58到）
    4. 点击"预订"按钮
    5. 自动跳转到订单填写页（http://localhost:5173/order）
    
    **前置条件**:
    - 用户已登录
    - 用户已选择车次
    
    **需要的图片资源**:
    - Logo（顶部导航，可以直接使用首页资源）
    - 列车图标（如有）
    - 乘客图标（如有）
    - 提示图标（如有）
    - 二维码（底部导航，4个：中国铁路官方微信、中国铁路官方微博、12306公众号、铁路12306，可以直接使用首页资源）
    - 友情链接（底部导航，4个：2行2列布局，可以直接使用首页资源）
    
    **主要功能**：
    - 显示选择的车次信息
    - 选择乘客（从常用乘客中选择或新增）
    - 选择席别（商务座、一等座、二等座等）
    - 选择座位偏好（靠窗、靠过道等，如有）
    - 显示票价信息
    - 提交订单
  
  dependencies:
    - REQ-LOGIN-PAGE
    - REQ-TRAIN-LIST-PAGE
  scenarios: []
  
  children:
    - id: REQ-ORDER-TOP-NAV
      name: 顶部导航栏（复用首页顶部导航栏内容）
      description: |
        页面顶部导航栏（与其他页面共用）。
        
        **需要截图**: 是
        **组件定位**: 页面最上方，横向占据整个页面宽度
        **定位提示**: header, nav, .header, [role="banner"]
        
        **功能要求**：
        - 显示12306品牌Logo
        - 显示主导航菜单
        - 显示用户登录状态
        - Logo点击返回首页
      
      dependencies: []
      scenarios: []
      children: []
    
    - id: REQ-ORDER-TRAIN-INFO
      name: 列车信息区域
      description: |
        显示用户选择的车次信息。
        
        **需要截图**: 是
        **组件定位**: 页面顶部，位于导航栏下方，横向展示
        **定位提示**: .train-info, .ticket-info, [class*="train"]
        
        **功能要求**：
        - 显示车次号（如G1）
        - 显示出发车站和到达车站
        - 显示出发时间和到达时间
        - 显示日期（如2024年1月1日）
        - 显示历时（如2小时15分）
        - 信息清晰易读，不可修改
      
      dependencies: []
      scenarios: []
      children: []
    
    - id: REQ-ORDER-PASSENGER-SELECT
      name: 乘客信息区域
      description: |
        选择乘客和席别的区域。
        
        **需要截图**: 是
        **组件定位**: 页面主内容区域上部，通常为列表或卡片形式
        **定位提示**: .passenger-select, .passenger-list, [class*="passenger"]
        
        **功能要求**：
        - 显示常用乘客列表（姓名、证件类型、证件号部分信息）
        - 支持勾选乘客（复选框）
        - 支持为每位乘客选择席别（下拉框或单选按钮）
        - 显示每个席别的票价
        - 支持添加新乘客（按钮）
        - 显示乘客类型（成人/儿童/学生）
        - 限制乘客数量（最多5人，根据实际规则）
        
        **交互场景截图**:
          - name: "整体页面截图"
            description: "获取订单填写页面的整体截图"
            前置条件: "从首页查询北京到上海G103次列车，点击预订后进入订单填写页"
            steps:
              - action: navigate
                url: "http://localhost:5173/"
              - action: click
                target: "出发城市输入框"
                target_hint: "textbox[placeholder='请选择城市']"
              - action: click
                target: "北京选项"
                target_hint: "div:has-text('北京')"
              - action: click
                target: "到达城市输入框"
                target_hint: "textbox[placeholder='请选择城市']"
              - action: click
                target: "上海选项"
                target_hint: "div:has-text('上海')"
              - action: click
                target: "出发日期输入框"
                target_hint: "textbox[placeholder='请选择日期']"
              - action: click
                target: "明天日期"
                target_hint: "日历中的18日"
              - action: click
                target: "查询按钮"
                target_hint: "button:has-text('查 询')"
              - action: wait
                duration: 2
              - action: click
                target: "G103预订按钮"
                target_hint: "button:has-text('预订')"
              - action: wait
                duration: 1
              - action: screenshot
                filename: "订单填写-整体页面.png"
                fullpage: true
                
          - name: "选择乘车人王三"
            description: "在乘客信息选项选择乘车人王三，获取页面截图"
            前置条件: "已进入订单填写页面"
            steps:
              - action: navigate
                url: "http://localhost:5173/order"
              - action: wait
                duration: 1
              - action: click
                target: "乘车人王三的复选框"
                target_hint: "input[type='checkbox'][name*='王三'], label:has-text('王三')"
              - action: wait
                duration: 0.5
              - action: screenshot
                filename: "订单填写-选择王三.png"
                fullpage: true
                
          - name: "未选择乘客提交订单"
            description: "测试不选择任何乘客直接提交订单"
            steps:
              - action: click
                target: "提交订单按钮"
                target_hint: "button:has-text('提交订单'), a:has-text('提交订单')"
              - action: wait
                duration: 0.5
              - action: screenshot
                filename: "订单填写-错误-未选择乘客.png"
                
          - name: "选择乘客"
            description: "测试选择第一个乘客"
            steps:
              - action: click
                target: "第一个乘客复选框"
                target_hint: ".passenger-item:first-child input[type='checkbox'], .passenger-list input[type='checkbox']:first-child"
              - action: wait
                duration: 0.5
              - action: screenshot
                filename: "订单填写-选择乘客.png"
                
          - name: "添加新乘客弹窗"
            description: "测试点击添加新乘客按钮"
            steps:
              - action: click
                target: "添加新乘客按钮"
                target_hint: "button:has-text('添加'), button:has-text('新增'), a:has-text('添加乘客')"
              - action: wait
                duration: 1
              - action: screenshot
                filename: "订单填写-添加乘客弹窗.png"
      
      dependencies: []
      
      scenarios:
        # 5.2 "席别"默认设置
        - name: 用户为G字头城际列车购票席别默认设置
          given: 用户选择了G字头车次进行购票
          when: 系统加载购票页面
          then: 页面购票信息区域的"席位"下拉框自动选择"二等座（¥xx元）"，xx为查询数据库得到的该车次二等座车票价格
          
        - name: 用户为C字头城际列车购票席别默认设置
          given: 用户选择了C字头车次进行购票
          when: 系统加载购票页面
          then: 页面购票信息区域的"席位"下拉框自动选择"二等座（¥xx元）"，xx为查询数据库得到的该车次二等座车票价格
          
        - name: 用户为D字头车次购票席别默认设置
          given: 用户选择了D字头车次进行购票
          when: 系统加载购票页面
          then: 页面购票信息区域的"席位"下拉框自动选择"二等座（¥xx元）"，xx为查询数据库得到的该车次二等座车票价格
          
        # 5.3 用户选择乘车人
        - name: 用户从列表中勾选第一名乘车人
          given: 用户在订单填写页且未勾选乘车人
          when: 用户点击某个乘车人前的勾选栏（如用户选择乘车人"王三"）
          then: 系统为该乘车人自动填充购票信息填写区域的序号为1的购票信息行，该行的"姓名"显示为乘车人姓名（如，王三）且不可修改，"证件类型"自动填充为该乘车人在数据库中保存的类型（如"居民身份证"）且不可修改，"证件号码"自动填充为该乘车人在数据库中保存的号码（如"3301************028"）且不可修改
          
        - name: 用户从列表中勾选额外的乘车人
          given: 用户在订单填写页且已勾选至少一个乘车人
          when: 用户点击某个乘车人前的勾选栏（如用户选择乘车人"王三"）
          then: 系统自动为该乘车人添加一个的购票信息行，该行的"姓名"显示为乘车人姓名（如，王三）且不可修改，"证件类型"自动填充为该乘车人在数据库中保存的类型（如"居民身份证"）且不可修改，"证件号码"自动填充为该乘车人在数据库中保存的号码（如"3301************028"）且不可修改
          
        - name: 用户尝试手动输入乘车人姓名
          given: 用户在订单填写页
          when: 用户点击"姓名"输入框并尝试输入文字
          then: 系统不响应任何输入，输入框内容无变化
          
        - name: 用户取消勾选唯一已选乘车人
          given: 用户已勾选一个乘车人（如"刘蕊蕊"）
          when: 用户再次点击该乘车人前的复选框，取消勾选
          then: 系统移除序号为1的购票信息行中该乘车人的信息，恢复至默认状态
          
        - name: 用户取消勾选多个已选乘车人中的一个
          given: 用户已勾选至少两个乘车人（如"刘蕊蕊"，"王三"）
          when: 用户再次点击该乘车人前的复选框，取消勾选
          then: 系统移除为该乘车人添加的乘车人信息行，其他乘车人信息行内容保持不变，序号自动做出调整
          
        # 5.4 用户选择席位
        - name: 用户展开席位下拉菜单
          given: 用户在订单填写页
          when: 用户点击该行的"席别"下拉菜单
          then: 下拉菜单中仅显示当前有票的席位及其价格（如"二等座（¥xx元）"，xx为查询数据库得到的该车次二等座车票价格，已售罄的席位不会出现在选项中
          
        - name: 用户更改席位选择
          given: 系统已为乘车人默认选择席别
          when: 用户从"席别"下拉菜单中选择其他席别
          then: 该乘车人的席位变更为用户选择的席别，票价信息随之更新
          
        - name: 未选择乘客
          given: 用户在订单填写页未选择任何乘客
          when: 用户点击"提交订单"
          then: 显示错误提示"请选择至少一位乘客！"
          
        - name: 未选择席别
          given: 用户选择了乘客但未为其选择席别
          when: 用户点击"提交订单"
          then: 显示错误提示"请为乘客选择席别！"
          
        - name: 选择的席别无票
          given: 用户选择的席别已售罄
          when: 用户点击"提交订单"
          then: 显示错误提示"所选席别余票不足！"或弹窗提示
          
        - name: 乘客信息不完整
          given: 用户添加的新乘客信息不完整
          when: 用户保存新乘客或提交订单
          then: 显示错误提示"乘客信息不完整！"
      
      children: []
    
    - id: REQ-ORDER-PRICE-INFO
      name: 订单金额区域
      description: |
        显示订单总金额和明细。
        
        **需要截图**: 是
        **组件定位**: 页面右侧或底部，通常为固定位置的卡片
        **定位提示**: .price-info, .order-summary, [class*="price"], [class*="amount"]
        
        **功能要求**：
        - 显示每位乘客的票价明细（姓名、席别、价格）
        - 显示订单总金额（元）
        - 金额自动计算
        - 样式醒目，便于用户确认
      
      dependencies: []
      scenarios: []
      children: []
    
    - id: REQ-ORDER-SUBMIT
      name: 提交订单区域
      description: |
        提交订单按钮和温馨提示。
        
        **需要截图**: 是
        **组件定位**: 页面底部或右侧，通常与价格信息相邻
        **定位提示**: .submit-order, .order-actions, [class*="submit"]
        
        **功能要求**：
        - 显示"提交订单"按钮（醒目的橙色）
        - 显示温馨提示（如"请核对订单信息"）
        - 显示购票须知（如退改签规则）
        - 按钮点击后显示加载状态
        - 提交成功后跳转到支付页面
      
      dependencies: []
      scenarios: []
      children: []
    
    - id: REQ-ORDER-CONFIRM-MODAL
      name: 订单确认弹窗（提交订单弹窗）
      description: |
        提交订单前的信息核对弹窗。
        
        **需要截图**: 是（通过交互场景触发）
        **组件定位**: 屏幕居中显示的模态弹窗，带半透明遮罩
        **定位提示**: .modal, [role="dialog"], .confirm-modal
        
        **功能要求**：
        - 显示车次信息摘要
        - 显示乘客信息列表
        - 显示订单总金额
        - 提供"确认无误，提交订单"按钮
        - 提供"返回修改"按钮
        - 点击遮罩关闭弹窗
        
        **前置条件**:
          - 完成 REQ-ORDER-PASSENGER-SELECT 的乘客选择
          - 需要登录状态
        
        **交互场景截图**:
          - name: "刷新页面并选择王三提交订单"
            description: "刷新页面后选择乘车人王三，点击提交订单，获取提交订单弹窗截图"
            前置条件: "保持在http://localhost:5173/order页面"
            steps:
              - action: navigate
                url: "http://localhost:5173/order"
              - action: wait
                duration: 1
              - action: click
                target: "乘车人王三的复选框"
                target_hint: "input[type='checkbox'][name*='王三'], label:has-text('王三')"
              - action: wait
                duration: 0.5
              - action: click
                target: "提交订单按钮"
                target_hint: "button:has-text('提交订单')"
              - action: wait
                duration: 1
              - action: wait_for_element
                target: "订单确认弹窗"
                target_hint: "[role='dialog'], .modal, .confirm-modal"
                timeout: 3
              - action: screenshot
                filename: "订单填写-提交订单弹窗.png"
                
          - name: "订单确认弹窗显示"
            description: "填写完订单信息后点击提交，显示确认弹窗"
            steps:
              - action: click
                target: "第一个乘客复选框"
                target_hint: ".passenger-item:first-child input[type='checkbox']"
              - action: wait
                duration: 0.5
              - action: click
                target: "提交订单按钮"
                target_hint: "button:has-text('提交订单')"
              - action: wait
                duration: 1
              - action: wait_for_element
                target: "订单确认弹窗"
                target_hint: "[role='dialog'], .modal"
                timeout: 3
              - action: screenshot
                filename: "订单确认弹窗-显示.png"
      
      dependencies:
        - REQ-ORDER-PASSENGER-SELECT
      
      scenarios:
        # 5.5 用户提交订单
        - name: 用户未选择任何乘车人点击"提交订单"
          given: 用户在订单填写页，未在乘客信息区域勾选任何乘车人
          when: 用户点击"提交订单"按钮
          then: 系统弹出确认弹窗（ConfirmModal），弹窗宽度90%，最大宽度400px，背景white（白色），圆角8px，阴影0 4px 12px rgba(0, 0, 0, 0.3)，弹窗标题栏内边距10px 20px，底部边框为#e0e0e0（浅灰色），标题字体大小18px，字体加粗，颜色white（白色），弹窗内容区域内边距20px，提示文字字体大小18px，行高1.6，颜色#333（深灰色），内容为"请选择乘车人！"，弹窗底部按钮区域内边距15px 20px，顶部边框为#e0e0e0（浅灰色），flex布局，居中对齐，间距30px，弹窗有"确认"按钮，内边距8px 20px，背景#ff6600（橙色），文字white（白色），圆角4px，字体大小14px，字体加粗，hover时背景#ff8833（浅橙色），点击可关闭弹窗，页面回到订单填写页
          
        - name: 用户提交订单时车票售罄
          given: 用户在订单填写页，并已勾选至少一名乘车人，用户网络正常
          when: 用户点击提交订单按钮，系统在向数据库确认车票时发现该车次该席别车票已经售罄，或者该席别车票余票数小于用户订单需求数量（可能因为其他用户在同一时间购买了该席别车票）
          then: 系统弹出确认弹窗（ConfirmModal），弹窗宽度90%，最大宽度400px，背景white（白色），圆角8px，阴影0 4px 12px rgba(0, 0, 0, 0.3)，弹窗标题栏内边距10px 20px，底部边框为#e0e0e0（浅灰色），标题字体大小18px，字体加粗，颜色white（白色），弹窗内容区域内边距20px，提示文字字体大小18px，行高1.6，颜色#333（深灰色），内容为"手慢了，该车次席别车票已售罄！"，弹窗底部按钮区域内边距15px 20px，顶部边框为#e0e0e0（浅灰色），flex布局，居中对齐，间距30px，弹窗有"确认"按钮，内边距8px 20px，背景#ff6600（橙色），文字white（白色），圆角4px，字体大小14px，字体加粗，hover时背景#ff8833（浅橙色），点击可关闭弹窗，页面回到车票查询界面
          
        - name: 用户选择乘车人后成功提交订单
          given: 用户在订单填写页，并已勾选至少一名乘车人，用户网络正常
          when: 用户点击"提交订单"按钮，系统确认用户选择的乘车人信息和席位，车票未售罄且可以满足用户提交订单的需求数量
          then: 页面在100ms之内跳出信息核对弹窗（OrderConfirmationModal）
          
        - name: 用户提交订单时网络异常
          given: 用户在订单填写页，并已勾选至少一名乘车人，用户网络异常
          when: 用户点击提交订单按钮
          then: 系统弹出确认弹窗（ConfirmModal），弹窗宽度90%，最大宽度400px，背景white（白色），圆角8px，阴影0 4px 12px rgba(0, 0, 0, 0.3)，弹窗标题栏内边距10px 20px，底部边框为#e0e0e0（浅灰色），标题字体大小18px，字体加粗，颜色white（白色），弹窗内容区域内边距20px，提示文字字体大小18px，行高1.6，颜色#333（深灰色），内容为"网络忙，请稍后再试。"，弹窗底部按钮区域内边距15px 20px，顶部边框为#e0e0e0（浅灰色），flex布局，居中对齐，间距30px，弹窗有"确认"按钮，内边距8px 20px，背景#ff6600（橙色），文字white（白色），圆角4px，字体大小14px，字体加粗，hover时背景#ff8833（浅橙色），点击可关闭提示弹窗，回到购票页面
          
        # 5.6.2 用户核对信息
        - name: 用户在信息核对弹窗点击返回修改
          given: 用户在成功提交订单后跳转至信息核对弹窗
          when: 用户点击"返回修改"按钮
          then: 系统回到订单填写页
          
        - name: 用户在信息核对弹窗点击确认
          given: 用户在成功提交订单后跳转至信息核对弹窗
          when: 用户点击"确认"按钮
          then: 页面弹出提示"订单已经提交，系统正在处理中，请稍等"，系统为用户保留座位预定信息，弹出提示"购买成功"，并显示用户预定的车票信息（包括座位号），将数据库中该座位从用户出发站到用户到达站之间的所有状态从"空闲"标记为"已被预定"
          
        # 原有场景
        - name: 确认提交订单
          given: 用户在订单确认弹窗中查看信息无误
          when: 用户点击"确认无误，提交订单"
          then: 提交订单，跳转到支付页面
          
        - name: 返回修改
          given: 用户在订单确认弹窗中发现信息有误
          when: 用户点击"返回修改"
          then: 关闭弹窗，返回订单填写页
      
      children: []
    
    - id: REQ-ORDER-ERROR-MODAL
      name: 订单错误提示弹窗
      description: |
        订单提交失败或余票不足时的提示弹窗。
        
        **需要截图**: 是（如能触发错误场景）
        **组件定位**: 屏幕居中显示的模态弹窗
        **定位提示**: .modal, [role="dialog"], .error-modal, .alert
        
        **功能要求**：
        - 显示错误图标（红色感叹号或叉号）
        - 显示错误信息（如"余票不足"、"订票失败"等）
        - 提供"我知道了"或"关闭"按钮
        - 点击按钮或遮罩关闭弹窗
      
      dependencies: []
      scenarios:
        - name: 余票不足
          given: 用户提交订单时所选席别余票已被抢光
          when: 系统检测到余票不足
          then: 显示"很抱歉，您选择的席别余票不足！"弹窗
          
        - name: 订票失败
          given: 用户提交订单时系统出现异常
          when: 订单提交失败
          then: 显示"订票失败，请稍后重试！"弹窗
      
      children: []

